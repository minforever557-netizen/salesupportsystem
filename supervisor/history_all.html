<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Job History - Supervisor</title>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body style="background: #f1f5f9;">

    <div class="container" style="max-width: 1100px; margin-top: 30px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</h2>
            <a href="main.html" style="color:#10b981; text-decoration:none;">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</a>
        </div>

        <div class="card" style="padding: 0;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead style="background: #f8fafc;">
                    <tr>
                        <th style="padding:15px; text-align:left;">‡πÄ‡∏•‡∏Ç‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï</th>
                        <th style="padding:15px; text-align:left;">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th>
                        <th style="padding:15px; text-align:left;">‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                        <th style="padding:15px; text-align:left;">‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</th>
                        <th style="padding:15px; text-align:left;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                    </tr>
                </thead>
                <tbody id="historyTable">
                    <tr><td colspan="5" style="text-align:center; padding:30px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, query, where, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCsUhBsWjZfQuJo5lgprYt3xikQUyf8iiw",
        authDomain: "sale-support-system.firebaseapp.com",
        projectId: "sale-support-system",
        storageBucket: "sale-support-system.firebasestorage.app",
        messagingSenderId: "640337786680",
        appId: "1:640337786680:web:fd80699ac291b8d7a7b3cd"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ‡∏î‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô Closed ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    const q = query(
        collection(db, "tickets"),
        where("status", "==", "Closed"),
        orderBy("updatedAt", "desc")
    );

    onSnapshot(q, (snap) => {
        const tbody = document.getElementById('historyTable');
        let html = '';
        snap.forEach(docSnap => {
            const t = docSnap.data();
            const updateTime = t.updatedAt ? t.updatedAt.toDate().toLocaleString('th-TH') : '-';
            html += `
                <tr style="border-top: 1px solid #eee;">
                    <td style="padding:15px;"><b>${t.internetNo}</b></td>
                    <td style="padding:15px;">${t.topic}</td>
                    <td style="padding:15px;"><small>${t.processedBy || 'N/A'}</small></td>
                    <td style="padding:15px;">${updateTime}</td>
                    <td style="padding:15px;"><div style="font-size:13px; color:#64748b;">${t.supNote || '-'}</div></td>
                </tr>
            `;
        });
        tbody.innerHTML = html || '<tr><td colspan="5" style="text-align:center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß</td></tr>';
    });
</script>
</body>
</html>
