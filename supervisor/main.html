<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Supervisor Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Remix Icon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">
    <!-- Global CSS -->
    <link rel="stylesheet" href="../style.css">
</head>
<body>

<div id="sidebarOverlay" class="sidebar-overlay"></div>

<div class="dashboard-layout">

    <!-- ===== SIDEBAR ===== -->
    <aside id="sidebar" class="dashboard-sidebar">
        <h2>SUPERVISOR</h2>

        <nav class="dashboard-nav">
            <a href="main.html" class="active">
                <i class="ri-dashboard-line"></i> Dashboard
            </a>
            <a href="history_all.html">
                <i class="ri-ticket-line"></i> Ticket ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </a>
            <a href="manage-job.html">
                <i class="ri-settings-3-line"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô
            </a>
            <a href="#" id="logoutBtn" class="dashboard-logout">
                <i class="ri-logout-box-line"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
            </a>
        </nav>
    </aside>

    <!-- ===== MAIN ===== -->
    <main class="dashboard-main">

        <!-- TOP BAR -->
        <div class="dashboard-top">
            <button id="hamburger" class="hamburger">
                <i class="ri-menu-line"></i>
            </button>
            <div class="dashboard-user" id="userEmail">-</div>
        </div>

        <h1 class="dashboard-title">üìä Supervisor Dashboard</h1>
        <p class="dashboard-desc">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>

        <!-- STATS -->
        <div class="dashboard-stats">
            <div class="stat-card">
                <small>Ticket ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</small>
                <h2 id="totalTicket">0</h2>
            </div>
            <div class="stat-card">
                <small>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</small>
                <h2 id="pendingTicket">0</h2>
            </div>
            <div class="stat-card">
                <small>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</small>
                <h2 id="doneTicket">0</h2>
            </div>
        </div>

        <!-- QUICK MENU -->
        <div class="dashboard-menu">
            <a href="history_all.html" class="menu-tile">
                <i class="ri-file-list-3-line"></i>
                <b>‡∏î‡∏π Ticket ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</b>
                <p>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏∏‡∏Å Ticket ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
            </a>

            <a href="manage-job.html" class="menu-tile">
                <i class="ri-tools-line"></i>
                <b>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</b>
                <p>Assign / Update Status</p>
            </a>
        </div>
        

    </main>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyCsUhBsWjZfQuJo5lgprYt3xikQUyf8iiw",
    authDomain: "sale-support-system.firebaseapp.com",
    projectId: "sale-support-system",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ===== Auth Guard ===== */
onAuthStateChanged(auth, user => {
    if (!user) location.href = "../index.html";
    userEmail.innerText = user.email;
});

/* ===== Realtime Ticket Count ===== */
onSnapshot(collection(db, "tickets"), snap => {
    let total = 0, pending = 0, done = 0;

    snap.forEach(doc => {
        total++;
        const status = doc.data().status;
        if (status === "Open") pending++;
        if (status === "Done") done++;
    });

    totalTicket.innerText = total;
    pendingTicket.innerText = pending;
    doneTicket.innerText = done;
});

/* ===== Logout ===== */
logoutBtn.onclick = () => signOut(auth);

/* ===== Mobile Sidebar ===== */
hamburger.onclick = () => {
    sidebar.classList.add("show");
    sidebarOverlay.classList.add("show");
};
sidebarOverlay.onclick = () => {
    sidebar.classList.remove("show");
    sidebarOverlay.classList.remove("show");
};
function showToast(text, type="success") {
    const toast = document.getElementById("toast");
    toast.innerText = text;
    toast.className = `toast-${type} show`;
    setTimeout(() => toast.classList.remove("show"), 2500);
}

</script>
<div id="toast" class="toast-success">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</div>

</body>
</html>
