<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Manage Job | Supervisor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- CSS ‡∏Å‡∏•‡∏≤‡∏á -->
<link rel="stylesheet" href="../style.css">
</head>

<body>

<!-- overlay mobile -->
<div id="sidebarOverlay" class="sidebar-overlay"></div>

<div class="dashboard-layout">

    <!-- ========== SIDEBAR (‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°) ========== -->
    <aside id="sidebar" class="dashboard-sidebar">
        <h2>SUPERVISOR</h2>
        <nav class="dashboard-nav">
            <a href="main.html">üìä Dashboard</a>
            <a href="manage-job.html" class="active">üõ†Ô∏è Manage Job</a>
            <a href="history_all.html">üìÇ History</a>
            <a href="#" class="dashboard-logout">üö™ Logout</a>
        </nav>
    </aside>

    <!-- ========== MAIN ========== -->
    <main class="dashboard-main">

        <div class="dashboard-top">
            <button id="hamburger" class="hamburger">‚ò∞</button>
            <div class="dashboard-user">
                <b id="userEmail">supervisor@email.com</b><br>
                <small>Supervisor</small>
            </div>
        </div>

        <h2>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô (Open / Pending)</h2>
        <p class="text-muted">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</p>

        <!-- JOB LIST -->
        <div id="jobList" class="dashboard-stats"></div>

    </main>
</div>

<!-- ========== MODAL ========== -->
<div id="jobModal" class="modal hidden">
    <div class="modal-card">

        <h3 id="modalTitle">-</h3>

        <div class="form-group">
            <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô</label>
            <select id="modalStatus" class="input">
                <option value="Open">Open</option>
                <option value="Pending">Pending</option>
                <option value="In Progress">In Progress</option>
                <option value="Closed">Closed</option>
            </select>
        </div>

        <div class="form-group">
            <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</label>
            <textarea
                id="modalComment"
                class="input"
                rows="4"
                placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"></textarea>
        </div>

        <button class="btn-primary" onclick="saveJob()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button class="btn-secondary" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>

    </div>
</div>

<script>
/* ========== MOBILE MENU ========== */
hamburger.onclick = () => {
    sidebar.classList.add("show");
    sidebarOverlay.classList.add("show");
};
sidebarOverlay.onclick = () => {
    sidebar.classList.remove("show");
    sidebarOverlay.classList.remove("show");
};

/* ========== MOCK DATA (‡πÅ‡∏ó‡∏ô Firestore) ========== */
const jobs = [
    { id:"T001", internetNo:"8800996377", title:"Internet ‡∏ä‡πâ‡∏≤", status:"Open" },
    { id:"T002", internetNo:"8800123456", title:"Router ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤", status:"Pending" },
    { id:"T003", internetNo:"8800778899", title:"‡∏™‡∏≤‡∏¢‡∏Ç‡∏≤‡∏î", status:"Closed" }
];

let currentJob = null;

/* ========== RENDER JOB CARD ========== */
function renderJobs() {
    const list = document.getElementById("jobList");
    list.innerHTML = "";

    const visibleJobs = jobs.filter(j =>
        j.status === "Open" || j.status === "Pending"
    );

    if (!visibleJobs.length) {
        list.innerHTML = "<p class='text-muted'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</p>";
        return;
    }

    visibleJobs.forEach(job => {
        const card = document.createElement("div");
        card.className = "stat-card clickable";

        card.innerHTML = `
            <small>${job.status}</small>
            <h3>${job.internetNo}</h3>
            <p>${job.title}</p>
        `;

        card.onclick = () => openModal(job);
        list.appendChild(card);
    });
}

/* ========== MODAL ========== */
function openModal(job) {
    currentJob = job;
    modalTitle.innerText = `Internet No: ${job.internetNo}`;
    modalStatus.value = job.status;
    modalComment.value = "";
    jobModal.classList.remove("hidden");
}

function closeModal() {
    jobModal.classList.add("hidden");
}

/* ========== SAVE ========== */
function saveJob() {
    const status = modalStatus.value;
    const comment = modalComment.value.trim();

    if (!comment) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£");
        return;
    }

    // update local
    currentJob.status = status;

    console.log("UPDATE JOB", {
        id: currentJob.id,
        status,
        comment
    });

    // üî• Firestore updateDoc ‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ

    closeModal();
    renderJobs();
}

/* ========== INIT ========== */
renderJobs();
</script>

</body>
</html>
