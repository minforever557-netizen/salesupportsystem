<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Register | Sale Portal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f4f6f9;
        }
        .card {
            border-radius: 12px;
        }
        .form-control, .form-select {
            border-radius: 10px;
        }
    </style>
</head>
<body>

<div class="container d-flex justify-content-center align-items-center min-vh-100">
    <div class="card shadow-sm p-4" style="max-width: 480px; width:100%;">
        <h3 class="text-center mb-4 text-success fw-bold">SALE PORTAL</h3>

        <form id="registerForm">

            <!-- Full Name -->
            <div class="mb-3">
                <label class="form-label">ชื่อ - นามสกุล</label>
                <input type="text" id="fullName" class="form-control" placeholder="เช่น นายสมชาย ใจดี" required>
            </div>

            <!-- Department -->
            <div class="mb-3">
                <label class="form-label">หน่วยงาน</label>
                <select id="department" class="form-select" required>
                    <option value="">-- เลือกหน่วยงาน --</option>
                    <option value="FBB Telesale">FBB Telesale</option>
                    <option value="FBB Dealer Sale">FBB Dealer Sale</option>
                    <option value="FBB Direct Sale">FBB Direct Sale</option>
                </select>
            </div>

            <!-- Team -->
            <div class="mb-3" id="teamSection" style="display:none;">
                <label class="form-label">ทีม</label>
                <select id="team" class="form-select">
                    <option value="">-- เลือกทีม --</option>
                </select>
            </div>

            <!-- Phone -->
            <div class="mb-3">
                <label class="form-label">เบอร์โทรศัพท์ที่ติดต่อได้</label>
                <input type="tel" id="phone" class="form-control" placeholder="เช่น 0812345678" required>
            </div>

            <!-- Email -->
            <div class="mb-3">
                <label class="form-label">อีเมลพนักงาน</label>
                <input type="email" id="email" class="form-control bg-warning-subtle" required>
            </div>

            <!-- Password -->
            <div class="mb-3">
                <label class="form-label">รหัสผ่าน</label>
                <input type="password" id="password" class="form-control bg-warning-subtle" required>
            </div>

            <!-- Confirm Password -->
            <div class="mb-4">
                <label class="form-label">ยืนยันรหัสผ่าน</label>
                <input type="password" id="confirmPassword" class="form-control" required>
            </div>

            <button type="submit" class="btn btn-success w-100 fw-bold">
                สมัครใช้งานระบบ
            </button>

        </form>
    </div>
</div>

<!-- Firebase -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    /* ===============================
       Firebase Config (แก้ของคุณ)
    ================================ */
    const firebaseConfig = {
  apiKey: "AIzaSyCsUhBsWjZfQuJo5lgprYt3xikQUyf8iiw",
  authDomain: "sale-support-system.firebaseapp.com",
  projectId: "sale-support-system",
  storageBucket: "sale-support-system.appspot.com",
  messagingSenderId: "640337786680",
  appId: "1:640337786680:web:fd80699ac291b8d7a7b3cd"
};


    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    /* ===============================
       Department → Team Filter
    ================================ */
    const departmentSelect = document.getElementById("department");
    const teamSection = document.getElementById("teamSection");
    const teamSelect = document.getElementById("team");

    departmentSelect.addEventListener("change", () => {
        const department = departmentSelect.value;
        teamSelect.innerHTML = `<option value="">-- เลือกทีม --</option>`;

        if (department === "FBB Dealer Sale") {
            teamSection.style.display = "block";
            for (let i = 1; i <= 10; i++) {
                teamSelect.innerHTML += `<option value="Team ${i}">Team ${i}</option>`;
            }
            teamSelect.required = true;

        } else if (department === "FBB Direct Sale") {
            teamSection.style.display = "block";
            for (let i = 1; i <= 6; i++) {
                teamSelect.innerHTML += `<option value="Team ${i}">Team ${i}</option>`;
            }
            teamSelect.required = true;

        } else {
            teamSection.style.display = "none";
            teamSelect.required = false;
            teamSelect.value = "";
        }
    });

    /* ===============================
       Register Submit
    ================================ */
    document.getElementById("registerForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const fullName = document.getElementById("fullName").value.trim();
        const department = departmentSelect.value;
        const team = teamSelect.value;
        const phone = document.getElementById("phone").value.trim();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;
        const confirmPassword = document.getElementById("confirmPassword").value;

        if (password !== confirmPassword) {
            alert("รหัสผ่านไม่ตรงกัน");
            return;
        }

        if (
            (department === "FBB Dealer Sale" || department === "FBB Direct Sale") 
            && !team
        ) {
            alert("กรุณาเลือกทีม");
            return;
        }

        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;

            await setDoc(doc(db, "users", user.uid), {
                fullName: fullName,
                email: email,
                department: department,
                team: department === "FBB Telesale" ? null : team,
                phone: phone,
                role: "user",
                status: "active",
                createdAt: serverTimestamp(),
                lastLogin: null
            });

            alert("สมัครใช้งานสำเร็จ");
            window.location.href = "login.html";

        } catch (error) {
            alert(error.message);
        }
    });
</script>

</body>
</html>
