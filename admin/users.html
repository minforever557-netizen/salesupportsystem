<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Manage Users - Admin</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">ADMIN PANEL</div>
        <div class="sidebar-menu">
            <a href="main.html">üìä <span>Dashboard</span></a>
            <a href="users.html" class="active">üë• <span>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span></a>
            <hr style="border:0; border-top:1px solid #374151; margin:10px 0;">
            <a href="#" id="logoutBtn" style="color: #ef4444;">üö™ <span>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span></a>
        </div>
    </div>

    <div class="main-content">
        <div class="container">
            <h2>üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h2>
            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Password (‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ)</th>
                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="userTable"></tbody>
                </table>
            </div>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = { /* Config ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô */ };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    onSnapshot(collection(db, "users"), (snap) => {
        let html = '';
        snap.forEach(userDoc => {
            const u = userDoc.data();
            html += `<tr>
                <td>${u.email}</td>
                <td><span class="status-badge bg-process">${u.role || 'user'}</span></td>
                <td style="font-family: monospace; color: #2563eb;">${u.password || '******'}</td>
                <td>
                    <select onchange="updateRole('${userDoc.id}', this.value)" style="padding:4px;">
                        <option value="user" ${u.role === 'user' ? 'selected' : ''}>User</option>
                        <option value="supervisor" ${u.role === 'supervisor' ? 'selected' : ''}>Sup</option>
                        <option value="admin" ${u.role === 'admin' ? 'selected' : ''}>Admin</option>
                    </select>
                </td>
            </tr>`;
        });
        document.getElementById('userTable').innerHTML = html;
    });

    window.updateRole = async (uid, newRole) => {
        await updateDoc(doc(db, "users", uid), { role: newRole });
        alert('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    };
</script>
</body>
</html>
