<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sale Dashboard - Sale Support</title>
<link rel="stylesheet" href="../style.css">
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
<style>
.menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-top: 20px; }
.menu-card {
background: white; padding: 40px; border-radius: 15px; text-align: center;
            text-decoration: none; color: var(--text-main); transition: 0.3s; box-shadow: var(--shadow);
            text-decoration: none; color: #111827; transition: 0.3s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
border: 1px solid transparent;
}
        .menu-card:hover { transform: translateY(-5px); border-color: var(--primary-green); }
        .menu-card i { font-size: 3rem; display: block; margin-bottom: 15px; }
        .menu-card:hover { transform: translateY(-5px); border-color: #10B981; }
        .menu-card-icon { font-size: 3rem; display: block; margin-bottom: 15px; }
.stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
.stat-box { padding: 20px; border-radius: 12px; color: white; text-align: center; }
        .stat-number { font-size: 1.8rem; font-weight: 600; margin-top: 5px; }
</style>
</head>
<body>
@@ -31,20 +33,39 @@
</div>

<div class="main-content">
        <div class="top-bar"><span id="userEmail" style="font-weight: 600; color: var(--text-muted);"></span></div>
        <div class="top-bar">
            <span id="userEmail" style="font-weight: 600; color: #6B7280;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
        </div>
<div class="container">
<h2>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, Sale Support</h2>
            <p style="color: var(--text-muted); margin-bottom: 30px;">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            <p style="color: #6B7280; margin-bottom: 30px;">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>

<div class="stat-grid">
                <div class="stat-box" style="background: #3B82F6;"><small>‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</small><div id="countAll">0</div></div>
                <div class="stat-box" style="background: #EF4444;"><small>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</small><div id="countOpen">0</div></div>
                <div class="stat-box" style="background: #10B981;"><small>‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</small><div id="countClosed">0</div></div>
                <div class="stat-box" style="background: #3B82F6;">
                    <small>‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</small>
                    <div id="countAll" class="stat-number">0</div>
                </div>
                <div class="stat-box" style="background: #EF4444;">
                    <small>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</small>
                    <div id="countOpen" class="stat-number">0</div>
                </div>
                <div class="stat-box" style="background: #10B981;">
                    <small>‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</small>
                    <div id="countClosed" class="stat-number">0</div>
                </div>
</div>

<div class="menu-grid">
                <a href="ticket.html" class="menu-card"><i>üìù</i><b>‡∏™‡πà‡∏á Ticket ‡πÉ‡∏´‡∏°‡πà</b><p>‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Internet ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p></a>
                <a href="history.html" class="menu-card"><i>üîç</i><b>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤/‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏≤‡∏ô</b><p>‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏≤‡∏Å Supervisor</p></a>
                <a href="ticket.html" class="menu-card">
                    <span class="menu-card-icon">üìù</span>
                    <b>‡∏™‡πà‡∏á Ticket ‡πÉ‡∏´‡∏°‡πà</b>
                    <p style="font-size: 0.9rem; color: #666;">‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Internet ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                </a>
                <a href="history.html" class="menu-card">
                    <span class="menu-card-icon">üîç</span>
                    <b>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤/‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏≤‡∏ô</b>
                    <p style="font-size: 0.9rem; color: #666;">‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏≤‡∏Å Supervisor</p>
                </a>
</div>
</div>
</div>
@@ -54,29 +75,55 @@
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, collection, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { /* ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì */ apiKey: "AIzaSyCsUhBsWjZfQuJo5lgprYt3xikQUyf8iiw", authDomain: "sale-support-system.firebaseapp.com", projectId: "sale-support-system", storageBucket: "sale-support-system.firebasestorage.app", messagingSenderId: "640337786680", appId: "1:640337786680:web:fd80699ac291b8d7a7b3cd" };
        // *** ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase Console ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ***
        const firebaseConfig = {
            apiKey: "AIzaSyCsUhBsWjZfQuJo5lgprYt3xikQUyf8iiw",
            authDomain: "sale-support-system.firebaseapp.com",
            projectId: "sale-support-system",
            storageBucket: "sale-support-system.firebasestorage.app",
            messagingSenderId: "640337786680",
            appId: "1:640337786680:web:fd80699ac291b8d7a7b3cd"
        };

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
onAuthStateChanged(auth, (user) => {
            if (!user) window.location.href = "../index.html";
            else {
            if (!user) {
                window.location.href = "../index.html";
            } else {
document.getElementById('userEmail').innerText = user.email;
                const q = query(collection(db, "tickets"), where("email", "==", user.email));
                onSnapshot(q, (snap) => {
                    let all = snap.size, open = 0, closed = 0;
                    snap.forEach(d => { 
                        if(d.data().status === 'Closed') closed++; 
                        else open++;
                    });
                    document.getElementById('countAll').innerText = all;
                    document.getElementById('countOpen').innerText = open;
                    document.getElementById('countClosed').innerText = closed;
                });
                fetchStats(user.email);
}
});
        document.getElementById('logoutBtn').onclick = () => signOut(auth).then(() => window.location.href = "../index.html");

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        function fetchStats(email) {
            const q = query(collection(db, "tickets"), where("email", "==", email));
            onSnapshot(q, (snap) => {
                let all = snap.size;
                let open = 0;
                let closed = 0;
                snap.forEach(doc => {
                    const status = doc.data().status;
                    if (status === 'Closed') closed++;
                    else open++;
                });
                document.getElementById('countAll').innerText = all;
                document.getElementById('countOpen').innerText = open;
                document.getElementById('countClosed').innerText = closed;
            });
        }

        // ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            signOut(auth).then(() => {
                window.location.href = "../index.html";
            });
        });
</script>
</body>
</html>
