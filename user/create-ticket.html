<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Create Ticket - Sale Support</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="../style.css">

<style>
/* ================= TOAST SYSTEM ================= */
.toast {
    position: fixed;
    bottom: 24px;
    right: 24px;
    min-width: 260px;
    max-width: 90%;
    padding: 16px 22px;
    border-radius: 16px;
    color: #fff;
    font-weight: 600;
    box-shadow: 0 20px 40px rgba(0,0,0,.25);
    opacity: 0;
    transform: translateY(40px) scale(.9);
    transition: all .45s cubic-bezier(.34,1.56,.64,1);
    z-index: 9999;
    pointer-events: none;
    text-align: center;
}

/* Slide + Bounce */
.toast.show {
    opacity: 1;
    transform: translateY(0) scale(1);
}

/* Colors */
.toast.success { background: linear-gradient(135deg,#22c55e,#16a34a); }
.toast.error   { background: linear-gradient(135deg,#ef4444,#b91c1c); }
.toast.warn    { background: linear-gradient(135deg,#f59e0b,#d97706); }

/* Mobile Center */
@media (max-width: 640px) {
    .toast {
        top: 50%;
        bottom: auto;
        right: 50%;
        transform: translate(50%, 60%) scale(.9);
    }
    .toast.show {
        transform: translate(50%, -50%) scale(1);
    }
}
</style>
</head>

<body>

<div class="dashboard-layout">

<aside class="dashboard-sidebar">
    <h2>SALE PORTAL</h2>
    <nav class="dashboard-nav">
        <a href="main.html">üè† Dashboard</a>
        <a href="create-ticket.html" class="active">üìù ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</a>
        <a href="history.html">üìÇ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a>
        <a href="#" id="logoutBtn" class="dashboard-logout">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
    </nav>
</aside>

<main class="dashboard-main" style="display:flex;justify-content:center;align-items:center;">

<div style="width:100%;max-width:460px">
<div class="auth-card">

<h2 class="auth-title">‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà</h2>
<p class="auth-subtitle">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Ticket</p>

<div class="form-group">
<label>Internet No</label>
<input id="internetNo" class="input" placeholder="AIS-123456">
</div>

<div class="form-group">
<label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏õ‡∏±‡∏ç‡∏´‡∏≤</label>
<select id="category" class="input">
<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏° --</option>
<option>Internet / Signal</option>
<option>Billing / Payment</option>
<option>Hardware / Device</option>
</select>
</div>

<div class="form-group">
<label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
<textarea id="detail" class="input" rows="4"></textarea>
</div>

<button id="submitBtn" class="btn-primary">‡∏™‡πà‡∏á Ticket</button>

</div>
</div>

</main>
</div>

<!-- ================= TOAST ================= -->
<div id="toast" class="toast"></div>

<!-- ================= SOUND ================= -->
<audio id="sound-success" src="https://assets.mixkit.co/sfx/preview/mixkit-positive-notification-951.mp3"></audio>
<audio id="sound-error"   src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyCsUhBsWjZfQuJo5lgprYt3xikQUyf8iiw",
    authDomain: "sale-support-system.firebaseapp.com",
    projectId: "sale-support-system"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ===== Toast System ===== */
const toast = document.getElementById("toast");
const sSuccess = document.getElementById("sound-success");
const sError = document.getElementById("sound-error");

function showToast(type, msg) {
    toast.className = `toast ${type}`;
    toast.innerText = msg;
    toast.classList.add("show");

    if (type === "success") sSuccess.play();
    if (type === "error") sError.play();

    setTimeout(() => toast.classList.remove("show"), 1800);
}

/* ===== Auth Guard ===== */
onAuthStateChanged(auth, user => {
    if (!user) location.href = "../index.html";
});

/* ===== Submit ===== */
submitBtn.onclick = async () => {

    if (!internetNo.value || !detail.value || !category.value) {
        showToast("warn", "‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
        return;
    }

    try {
        await addDoc(collection(db, "tickets"), {
            email: auth.currentUser.email,
            internetNo: internetNo.value,
            category: category.value,
            detail: detail.value,
            status: "Open",
            createdAt: serverTimestamp()
        });

        showToast("success", "‚úÖ ‡∏™‡πà‡∏á Ticket ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");

        setTimeout(() => location.href = "main.html", 2000);

    } catch (err) {
        showToast("error", "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
    }
};

/* ===== Logout ===== */
logoutBtn.onclick = () => signOut(auth);
</script>

</body>
</html>
